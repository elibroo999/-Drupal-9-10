# SB Projects

Кастомный модуль для Drupal 9/10.

## Функциональность модуля
1. Создаёт новый тип материала **Проект** (node type `project`).
2. Реализует блок **«Последние проекты (3)»**, который выводит ссылки на три последних опубликованных проекта.
3. Реализует простой REST-эндпоинт **`/api/projects`** (GET), который возвращает JSON с последними 3 проектами.

## Инструкция по запуску
1. Скопируйте папку `sb_projects` в директорию `/modules/custom/` вашего проекта Drupal.
2. Включите модуль в админке:  
   **Расширения → SB Projects → Установить**.
3. Добавьте поля к типу материала Проект:
Структура → Типы материалов → Проект → Управление полями

field_description — Текст (длинный)

field_media_image — Ссылка на медиа (тип медиа «Изображение + текст»)

field_end_date — Дата / Дата-время

Важно: контроллер по умолчанию читает field_media_image на ноде (media reference).
Если у вас вместо Media используется обычное Image-поле field_image, API тоже отработает — код поддерживает оба варианта.

4. Создайте несколько материалов этого типа: 
**Содержание → Добавить материал → Проект**.
5. Разместите блок **«Последние проекты (3)»**:  
   **Структура → Блоки → Разместить блок** → выберите регион (например, Content) и установите видимость для главной страницы (`<front>`).
6. Проверьте работу API:
   откройте /api/projects - вы получите массив с последними 3 проектами в формате JSON.
   Пример ответа:

   [
  {
    "title": "Первый проект",
    "description": "Описание проекта",
    "image": "https://example.com/sites/default/files/2025-09/image.jpg",
    "end_date": "2025-12-31"
  }
   ]



## Архитектурные решения
- Тип материала project создаётся конфигурацией в config/install/node.type.project.yml.
Поля добавляются через UI — это упрощает развёртывание и проверку на стенде.
- Блок реализован как плагин LatestProjectsBlock (src/Plugin/Block/LatestProjectsBlock.php).
Используется entityQuery со сортировкой по created DESC и ограничением range(0, 3).
Кэш блока опирается на стандартные теги (node_list, node:<id>), поэтому обновляется при создании/редактировании нод.
- API реализован контроллером ProjectsApiController::list().
Запрос нод сделан через entityQuery с ->accessCheck(TRUE) (корректно для Drupal 10.2+).
Для изображений используется сервис file_url_generator — правильный способ формировать абсолютные URL.
Если на ноде поле — media reference (field_media_image), имя «внутреннего» поля файла берётся публичным API медиа-типа (getSource()->getSourceFieldDefinition(...)->getName()), без жесткого хардкода.
Также поддержан сценарий с обычным image/file-полем (field_image).

## Сложности
 - Основной вызов - вспомнить правильную структуру плагина блока и роутинга для контроллера.
 - Подбор правильного способа генерации URL для картинок (выбран сервис file_url_generator - современный и рекомендуемый).
 - Кэш блока сначала был отключён для удобства тестирования, но потом наменён на cache tags, чтобы это было корректно и в продакшене.
 - Поиск правильных эндпоинтов в API, в особенности у image
