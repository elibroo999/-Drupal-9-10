# SB Projects

Кастомный модуль для Drupal 9/10.

## Функциональность модуля
1. Создаёт новый тип материала **Проект** (node type `project`).
2. Реализует блок **«Последние проекты (3)»**, который выводит ссылки на три последних опубликованных проекта.
3. Реализует простой REST-эндпоинт **`/api/projects`** (GET), который возвращает JSON с последними 3 проектами.

## Инструкция по запуску
1. Скопируйте папку `sb_projects` в директорию `/modules/custom/` вашего проекта Drupal.
2. Включите модуль в админке:  
   **Расширения → SB Projects → Установить**.
3. Добавьте поля к типу материала «Проект» через админку:  
   **Структура → Типы материалов → Проект → Управление полями**  
   * `field_description` - Текст
   * `field_image` - Изображение
   * `field_end_date` - Дата
   ```
   Важно: при создании полей следите, чтобы machine name совпадал с указанным выше (field_description, field_image, field_end_date), иначе код модуля не найдёт эти поля и они будут пустыми в API и блоке.
   ```
4. Создайте несколько материалов этого типа: 
**Содержание → Добавить материал → Проект**.
5. Разместите блок **«Последние проекты (3)»**:  
   **Структура → Блоки → Разместить блок** → выберите регион (например, Content) и установите видимость для главной страницы (`<front>`).
6. Проверьте работу API:
   откройте /api/projects - вы получите массив с последними 3 проектами в формате JSON.
   Пример ответа:
   ```
   [
  {
    "title": "Первый проект",
    "description": "Описание проекта",
    "image": "https://example.com/sites/default/files/2025-09/image.jpg",
    "end_date": "2025-12-31"
  }
   ]
   ```


## Архитектурные решения
- Простота кода: код короткий и понятный, его легко поддерживать.
- Тип материала «Проект» создаётся через конфигурационный файл 
`config/install/node.type.project.yml` - установка автоматическая, но поля создаются руками для упрощения. 
- Блок реализован как плагин `LatestProjectsBlock` в `src/Plugin/Block/`.  
  В нём используется `entityQuery`, чтобы выбрать последние 3 опубликованных проекта.
  Кэш настраивается через node_list (Drupal сам сбрасывает его при добавлении/обновлении проектов).
- API реализован как простой контроллер ProjectsApiController.
  Всего один метод list(), который делает entityQuery и возвращает JSON.
  Абсолютный URL для изображений формулируется с помощью сервиса file_url_generator, что является рекомендуемым способом в Drupal 9/10.

## Сложности
 - Основной вызов - вспомнить правильную структуру плагина блока и роутинга для контроллера.
 - Подбор правильного способа генерации URL для картинок (выбран сервис file_url_generator - современный и рекомендуемый).
 - Кэш блока сначала был отключён для удобства тестирования, но потом наменён на cache tags, чтобы это было корректно и в продакшене.